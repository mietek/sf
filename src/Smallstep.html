<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>Smallstep: Small-step Operational Semantics</title>
<script type="text/javascript" src="jquery-1.8.3.js"></script>
<script type="text/javascript" src="main.js"></script>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Smallstep<span class="subtitle">Small-step Operational Semantics</span></h1>

<div class="code code-tight">
</div>

<div class="doc">

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">Imp</span>.<br/>

<br/>
</div>

<div class="doc">
The evaluators we have seen so far (e.g., the ones for
    <span class="inlinecode"><span class="id" type="var">aexp</span></span>s, <span class="inlinecode"><span class="id" type="var">bexp</span></span>s, and commands) have been formulated in a
    "big-step" style &mdash; they specify how a given expression can be
    evaluated to its final value (or a command plus a store to a final
    store) "all in one big step."

<div class="paragraph"> </div>

    This style is simple and natural for many purposes &mdash; indeed,
    Gilles Kahn, who popularized its use, called it <i>natural
    semantics</i>.  But there are some things it does not do well.  In
    particular, it does not give us a natural way of talking about
    <i>concurrent</i> programming languages, where the "semantics" of a
    program &mdash; i.e., the essence of how it behaves &mdash; is not just
    which input states get mapped to which output states, but also
    includes the intermediate states that it passes through along the
    way, since these states can also be observed by concurrently
    executing code.

<div class="paragraph"> </div>

    Another shortcoming of the big-step style is more technical, but
    critical in some situations.  To see the issue, suppose we wanted
    to define a variant of Imp where variables could hold <i>either</i>
    numbers <i>or</i> lists of numbers (see the <span class="inlinecode"><span class="id" type="var">HoareList</span></span> chapter for
    details).  In the syntax of this extended language, it will be
    possible to write strange expressions like <span class="inlinecode">2</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" type="var">nil</span></span>, and our
    semantics for arithmetic expressions will then need to say
    something about how such expressions behave.  One
    possibility (explored in the <span class="inlinecode"><span class="id" type="var">HoareList</span></span> chapter) is to maintain
    the convention that every arithmetic expressions evaluates to some
    number by choosing some way of viewing a list as a number &mdash; e.g.,
    by specifying that a list should be interpreted as <span class="inlinecode">0</span> when it
    occurs in a context expecting a number.  But this is really a bit
    of a hack.

<div class="paragraph"> </div>

    A much more natural approach is simply to say that the behavior of
    an expression like <span class="inlinecode">2+<span class="id" type="var">nil</span></span> is <i>undefined</i> &mdash; it doesn't evaluate
    to any result at all.  And we can easily do this: we just have to
    formulate <span class="inlinecode"><span class="id" type="var">aeval</span></span> and <span class="inlinecode"><span class="id" type="var">beval</span></span> as <span class="inlinecode"><span class="id" type="keyword">Inductive</span></span> propositions rather
    than Fixpoints, so that we can make them partial functions instead
    of total ones.

<div class="paragraph"> </div>

    However, now we encounter a serious deficiency.  In this language,
    a command might <i>fail</i> to map a given starting state to any ending
    state for two quite different reasons: either because the
    execution gets into an infinite loop or because, at some point,
    the program tries to do an operation that makes no sense, such as
    adding a number to a list, and none of the evaluation rules can be
    applied.

<div class="paragraph"> </div>

    These two outcomes &mdash; nontermination vs. getting stuck in an
    erroneous configuration &mdash; are quite different.  In particular, we
    want to allow the first (permitting the possibility of infinite
    loops is the price we pay for the convenience of programming with
    general looping constructs like <span class="inlinecode"><span class="id" type="var">while</span></span>) but prevent the
    second (which is just wrong), for example by adding some form of
    <i>typechecking</i> to the language.  Indeed, this will be a major
    topic for the rest of the course.  As a first step, we need a
    different way of presenting the semantics that allows us to
    distinguish nontermination from erroneous "stuck states."

<div class="paragraph"> </div>

    So, for lots of reasons, we'd like to have a finer-grained way of
    defining and reasoning about program behaviors.  This is the topic
    of the present chapter.  We replace the "big-step" <span class="inlinecode"><span class="id" type="var">eval</span></span> relation
    with a "small-step" relation that specifies, for a given program,
    how the "atomic steps" of computation are performed. 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
<a name="lab588"></a><h1 class="section">A Toy Language</h1>

<div class="paragraph"> </div>

 To save space in the discussion, let's go back to an
    incredibly simple language containing just constants and
    addition.  (We use single letters &mdash; <span class="inlinecode"><span class="id" type="var">C</span></span> and <span class="inlinecode"><span class="id" type="var">P</span></span> &mdash; for the
    constructor names, for brevity.)  At the end of the chapter, we'll
    see how to apply the same techniques to the full Imp language.  
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">tm</span> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">C</span> : <span class="id" type="var">nat</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span>         <span class="comment">(*&nbsp;Constant&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">P</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span>. <span class="comment">(*&nbsp;Plus&nbsp;*)</span><br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "tm_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "C" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "P" ].<br/>

<br/>
</div>

<div class="doc">
Here is a standard evaluator for this language, written in the
    same (big-step) style as we've been using up to this point. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">evalF</span> (<span class="id" type="var">t</span> : <span class="id" type="var">tm</span>) : <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">C</span> <span class="id" type="var">n</span> ⇒ <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">P</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> ⇒ <span class="id" type="var">evalF</span> <span class="id" type="var">a1</span> + <span class="id" type="var">evalF</span> <span class="id" type="var">a2</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Now, here is the same evaluator, written in exactly the same
    style, but formulated as an inductively defined relation.  Again,
    we use the notation <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&dArr;</span></span> <span class="inlinecode"><span class="id" type="var">n</span></span> for "<span class="inlinecode"><span class="id" type="var">t</span></span> evaluates to <span class="inlinecode"><span class="id" type="var">n</span></span>." 
<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (E_Const) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">C&nbsp;n&nbsp;<span style="font-family: arial;">&dArr;</span>&nbsp;n</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub>&nbsp;<span style="font-family: arial;">&dArr;</span>&nbsp;n1</td>
  <td></td>
</td>
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub>&nbsp;<span style="font-family: arial;">&dArr;</span>&nbsp;n2</td>
  <td class="infrulenamecol" rowspan="3">
    (E_Plus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;t<sub>1</sub>&nbsp;t<sub>2</sub>&nbsp;<span style="font-family: arial;">&dArr;</span>&nbsp;C&nbsp;(n1&nbsp;+&nbsp;n2)</td>
  <td></td>
</td>
</table></center>
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&dArr;</span>' n " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 50, <span class="id" type="var">left</span> <span class="id" type="var">associativity</span>).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">eval</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">nat</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
&nbsp;&nbsp;| <span class="id" type="var">E_Const</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">C</span> <span class="id" type="var">n</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">E_Plus</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n1</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n2</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&dArr;</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&dArr;</span>' n " := (<span class="id" type="var">eval</span> <span class="id" type="var">t</span> <span class="id" type="var">n</span>).<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "eval_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_Const" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_Plus" ].<br/>
</div>

<br/>

<br/>
</div>

<div class="doc">
Now, here is a small-step version. 
<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_PlusConstConst) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;(C&nbsp;n1)&nbsp;(C&nbsp;n2)&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;C&nbsp;(n1&nbsp;+&nbsp;n2)</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;t<sub>1</sub>&nbsp;t<sub>2</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;P&nbsp;t<sub>1</sub>'&nbsp;t<sub>2</sub></td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;(C&nbsp;n1)&nbsp;t<sub>2</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;P&nbsp;(C&nbsp;n1)&nbsp;t<sub>2</sub>'</td>
  <td></td>
</td>
</table></center>
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_PlusConstConst</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>) <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">C</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n1</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub>'</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) <span class="id" type="var">t<sub>2</sub>'</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" type="keyword">Tactic Notation</span> "step_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_PlusConstConst"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Plus1" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Plus2" ].<br/>
</div>

<br/>
</div>

<div class="doc">
Things to notice:

<div class="paragraph"> </div>

<ul class="doclist">
<li> We are defining just a single reduction step, in which
      one <span class="inlinecode"><span class="id" type="var">P</span></span> node is replaced by its value.

<div class="paragraph"> </div>


</li>
<li> Each step finds the <i>leftmost</i> <span class="inlinecode"><span class="id" type="var">P</span></span> node that is ready to
      go (both of its operands are constants) and rewrites it in
      place.  The first rule tells how to rewrite this <span class="inlinecode"><span class="id" type="var">P</span></span> node
      itself; the other two rules tell how to find it.

<div class="paragraph"> </div>


</li>
<li> A term that is just a constant cannot take a step. 
</li>
</ul>

<div class="paragraph"> </div>

 Let's pause and check a couple of examples of reasoning with
    the <span class="inlinecode"><span class="id" type="var">step</span></span> relation... 
<div class="paragraph"> </div>

 If <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> can take a step to <span class="inlinecode"><span class="id" type="var">t<sub>1</sub>'</span></span>, then <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> steps
    to <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span>: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Example</span> <span class="id" type="var">test_step_1</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 0) (<span class="id" type="var">C</span> 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 2) (<span class="id" type="var">C</span> 4))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> (0 + 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 2) (<span class="id" type="var">C</span> 4)).<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
<a name="lab589"></a><h4 class="section">Exercise: 1 star (test_step_2)</h4>
 Right-hand sides of sums can take a step only when the
    left-hand side is finished: if <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> can take a step to <span class="inlinecode"><span class="id" type="var">t<sub>2</sub>'</span></span>,
    then <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode">(<span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n</span>)</span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> steps to <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode">(<span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n</span>)</span>
    <span class="inlinecode"><span class="id" type="var">t<sub>2</sub>'</span></span>: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Example</span> <span class="id" type="var">test_step_2</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> 2) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 0) (<span class="id" type="var">C</span> 3)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> 2) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> (0 + 3))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
<a name="lab590"></a><h1 class="section">Relations</h1>

<div class="paragraph"> </div>

 We will be using several different step relations, so it is
    helpful to generalize a bit and state a few definitions and
    theorems about relations in general.  (The optional chapter
    <span class="inlinecode"><span class="id" type="var">Rel.v</span></span> develops some of these ideas in a bit more detail; it may
    be useful if the treatment here is too dense.) 
<div class="paragraph"> </div>

 A (binary) <i>relation</i> on a set <span class="inlinecode"><span class="id" type="var">X</span></span> is a family of propositions
    parameterized by two elements of <span class="inlinecode"><span class="id" type="var">X</span></span> &mdash; i.e., a proposition about
    pairs of elements of <span class="inlinecode"><span class="id" type="var">X</span></span>.  
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">relation</span> (<span class="id" type="var">X</span>: <span class="id" type="keyword">Type</span>) := <span class="id" type="var">X</span><span style="font-family: arial;">&rarr;</span><span class="id" type="var">X</span><span style="font-family: arial;">&rarr;</span><span class="id" type="keyword">Prop</span>.<br/>

<br/>
</div>

<div class="doc">
Our main examples of such relations in this chapter will be
    the single-step and multi-step reduction relations on terms, <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span>
    and <span class="inlinecode"><span style="font-family: arial;">&rArr;*</span></span>, but there are many other examples &mdash; some that come to
    mind are the "equals," "less than," "less than or equal to," and
    "is the square of" relations on numbers, and the "prefix of"
    relation on lists and strings. 
<div class="paragraph"> </div>

 One simple property of the <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> relation is that, like the
    evaluation relation for our language of Imp programs, it is
    <i>deterministic</i>.

<div class="paragraph"> </div>

    <i>Theorem</i>: For each <span class="inlinecode"><span class="id" type="var">t</span></span>, there is at most one <span class="inlinecode"><span class="id" type="var">t'</span></span> such that <span class="inlinecode"><span class="id" type="var">t</span></span>
    steps to <span class="inlinecode"><span class="id" type="var">t'</span></span> (<span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span> is provable).  Formally, this is the
    same as saying that <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> is deterministic. 
<div class="paragraph"> </div>

 <i>Proof sketch</i>: We show that if <span class="inlinecode"><span class="id" type="var">x</span></span> steps to both <span class="inlinecode"><span class="id" type="var">y1</span></span> and <span class="inlinecode"><span class="id" type="var">y2</span></span>
    then <span class="inlinecode"><span class="id" type="var">y1</span></span> and <span class="inlinecode"><span class="id" type="var">y2</span></span> are equal, by induction on a derivation of
    <span class="inlinecode"><span class="id" type="var">step</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">y1</span></span>.  There are several cases to consider, depending on
    the last rule used in this derivation and in the given derivation
    of <span class="inlinecode"><span class="id" type="var">step</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">y2</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If both are <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span>, the result is immediate.

<div class="paragraph"> </div>


</li>
<li> The cases when both derivations end with <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span> or
        <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span> follow by the induction hypothesis.  

<div class="paragraph"> </div>


</li>
<li> It cannot happen that one is <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span> and the other
        is <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span> or <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span>, since this would imply that <span class="inlinecode"><span class="id" type="var">x</span></span> has
        the form <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> where both <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> are
        constants (by <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span>) <i>and</i> one of <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> has
        the form <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode">...</span>.

<div class="paragraph"> </div>


</li>
<li> Similarly, it cannot happen that one is <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span> and the other
        is <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span>, since this would imply that <span class="inlinecode"><span class="id" type="var">x</span></span> has the form
        <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> where <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> has both the form <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> and
        the form <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n</span></span>. <font size=-2>&#9744;</font> 
</li>
</ul>

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">deterministic</span> {<span class="id" type="var">X</span>: <span class="id" type="keyword">Type</span>} (<span class="id" type="var">R</span>: <span class="id" type="var">relation</span> <span class="id" type="var">X</span>) :=<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&forall;</span><span class="id" type="var">x</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> : <span class="id" type="var">X</span>, <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y1</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y2</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">y1</span> = <span class="id" type="var">y2</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">step_deterministic</span>:<br/>
&nbsp;&nbsp;<span class="id" type="var">deterministic</span> <span class="id" type="var">step</span>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">deterministic</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> <span class="id" type="var">Hy1</span> <span class="id" type="var">Hy2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">y2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">step_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Hy1</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">y2</span> <span class="id" type="var">Hy2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "ST_PlusConstConst". <span class="id" type="var">step_cases</span> (<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hy2</span>) <span class="id" type="var">SCase</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_PlusConstConst". <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_Plus1". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_Plus2". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "ST_Plus1". <span class="id" type="var">step_cases</span> (<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hy2</span>) <span class="id" type="var">SCase</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_PlusConstConst". <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hy1</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hy1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_Plus1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> (<span class="id" type="var">IHHy1</span> <span class="id" type="var">t<sub>1</sub>'0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_Plus2". <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hy1</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hy1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "ST_Plus2". <span class="id" type="var">step_cases</span> (<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hy2</span>) <span class="id" type="var">SCase</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_PlusConstConst". <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hy1</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hy1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_Plus1". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ST_Plus2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> (<span class="id" type="var">IHHy1</span> <span class="id" type="var">t<sub>2</sub>'0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
There is some annoying repetition in this proof.
    Each use of <span class="inlinecode"><span class="id" type="tactic">inversion</span></span> <span class="inlinecode"><span class="id" type="var">Hy2</span></span> results in three subcases, 
    only one of which is relevant (the one which matches the 
    current case in the induction on <span class="inlinecode"><span class="id" type="var">Hy1</span></span>). The other two
    subcases need to be dismissed by finding the contradiction
    among the hypotheses and doing inversion on it.

<div class="paragraph"> </div>

    There is a tactic called <span class="inlinecode"><span class="id" type="var">solve</span></span> <span class="inlinecode"><span class="id" type="tactic">by</span></span> <span class="inlinecode"><span class="id" type="tactic">inversion</span></span> defined in <span class="inlinecode"><span class="id" type="var">SfLib.v</span></span>
    that can be of use in such cases. It will solve the goal if it
    can be solved by inverting some hypothesis; otherwise, it fails.
    (There are variants <span class="inlinecode"><span class="id" type="var">solve</span></span> <span class="inlinecode"><span class="id" type="tactic">by</span></span> <span class="inlinecode"><span class="id" type="tactic">inversion</span></span> <span class="inlinecode">2</span> and <span class="inlinecode"><span class="id" type="var">solve</span></span> <span class="inlinecode"><span class="id" type="tactic">by</span></span> <span class="inlinecode"><span class="id" type="tactic">inversion</span></span> <span class="inlinecode">3</span>
    that work if two or three consecutive inversions will solve the goal.)

<div class="paragraph"> </div>

    The example below shows how a proof of the previous theorem can be
    simplified using this tactic.

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">step_deterministic_alt</span>: <span class="id" type="var">deterministic</span> <span class="id" type="var">step</span>.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> <span class="id" type="var">Hy1</span> <span class="id" type="var">Hy2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">y2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">step_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">Hy1</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">y2</span> <span class="id" type="var">Hy2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hy2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> (<span class="id" type="var">solve</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">inversion</span>).<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "ST_PlusConstConst". <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "ST_Plus1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHHy1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "ST_Plus2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHHy1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">SimpleArith1</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab591"></a><h2 class="section">Values</h2>

<div class="paragraph"> </div>

 Let's take a moment to slightly generalize the way we state the
    definition of single-step reduction.  
<div class="paragraph"> </div>

 It is useful to think of the <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> relation as defining an
    <i>abstract machine</i>:

<div class="paragraph"> </div>

<ul class="doclist">
<li> At any moment, the <i>state</i> of the machine is a term.

<div class="paragraph"> </div>


</li>
<li> A <i>step</i> of the machine is an atomic unit of computation &mdash;
        here, a single "add" operation.

<div class="paragraph"> </div>


</li>
<li> The <i>halting states</i> of the machine are ones where there is no
        more computation to be done.

</li>
</ul>

<div class="paragraph"> </div>

    We can then execute a term <span class="inlinecode"><span class="id" type="var">t</span></span> as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Take <span class="inlinecode"><span class="id" type="var">t</span></span> as the starting state of the machine.

<div class="paragraph"> </div>


</li>
<li> Repeatedly use the <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> relation to find a sequence of
        machine states, starting with <span class="inlinecode"><span class="id" type="var">t</span></span>, where each state steps to
        the next.

<div class="paragraph"> </div>


</li>
<li> When no more reduction is possible, "read out" the final state
        of the machine as the result of execution. 
</li>
</ul>

<div class="paragraph"> </div>

 Intuitively, it is clear that the final states of the
    machine are always terms of the form <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n</span></span> for some <span class="inlinecode"><span class="id" type="var">n</span></span>.
    We call such terms <i>values</i>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">value</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">v_const</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>, <span class="id" type="var">value</span> (<span class="id" type="var">C</span> <span class="id" type="var">n</span>).<br/>

<br/>
</div>

<div class="doc">
Having introduced the idea of values, we can use it in the
    definition of the <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> relation to write <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span> rule in a
    slightly more elegant way: 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_PlusConstConst) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;(C&nbsp;n1)&nbsp;(C&nbsp;n2)&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;C&nbsp;(n1&nbsp;+&nbsp;n2)</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;t<sub>1</sub>&nbsp;t<sub>2</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;P&nbsp;t<sub>1</sub>'&nbsp;t<sub>2</sub></td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">value&nbsp;v<sub>1</sub></td>
  <td></td>
</td>
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Plus2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;v<sub>1</sub>&nbsp;t<sub>2</sub>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;P&nbsp;v<sub>1</sub>&nbsp;t<sub>2</sub>'</td>
  <td></td>
</td>
</table></center> Again, the variable names here carry important information:
    by convention, <span class="inlinecode"><span class="id" type="var">v<sub>1</sub></span></span> ranges only over values, while <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span>
    range over arbitrary terms.  (Given this convention, the explicit
    <span class="inlinecode"><span class="id" type="var">value</span></span> hypothesis is arguably redundant.  We'll keep it for now,
    to maintain a close correspondence between the informal and Coq
    versions of the rules, but later on we'll drop it in informal
    rules, for the sake of brevity.) 
<div class="paragraph"> </div>

  Here are the formal rules: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_PlusConstConst</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span> <span class="id" type="var">C</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span>                     <span class="comment">(*&nbsp;&lt;-----&nbsp;n.b.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub>'</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" type="keyword">Tactic Notation</span> "step_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_PlusConstConst"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Plus1" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Plus2" ].<br/>
</div>

<br/>
</div>

<div class="doc">
<a name="lab592"></a><h4 class="section">Exercise: 3 stars (redo_determinism)</h4>
 As a sanity check on this change, let's re-verify determinism 

<div class="paragraph"> </div>

    Proof sketch: We must show that if <span class="inlinecode"><span class="id" type="var">x</span></span> steps to both <span class="inlinecode"><span class="id" type="var">y1</span></span> and <span class="inlinecode"><span class="id" type="var">y2</span></span>
    then <span class="inlinecode"><span class="id" type="var">y1</span></span> and <span class="inlinecode"><span class="id" type="var">y2</span></span> are equal.  Consider the final rules used in
    the derivations of <span class="inlinecode"><span class="id" type="var">step</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">y1</span></span> and <span class="inlinecode"><span class="id" type="var">step</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode"><span class="id" type="var">y2</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If both are <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span>, the result is immediate.

<div class="paragraph"> </div>


</li>
<li> It cannot happen that one is <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span> and the other
      is <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span> or <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span>, since this would imply that <span class="inlinecode"><span class="id" type="var">x</span></span> has
      the form <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> where both <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> are
      constants (by <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span>) AND one of <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> or <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> has
      the form <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode">...</span>.

<div class="paragraph"> </div>


</li>
<li> Similarly, it cannot happen that one is <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span> and the other
      is <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span>, since this would imply that <span class="inlinecode"><span class="id" type="var">x</span></span> has the form
      <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> where <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> both has the form <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> and
      is a value (hence has the form <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n</span></span>).

<div class="paragraph"> </div>


</li>
<li> The cases when both derivations end with <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span> or
      <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span> follow by the induction hypothesis. <font size=-2>&#9744;</font> 
</li>
</ul>

<div class="paragraph"> </div>

 Most of this proof is the same as the one above.  But to get
    maximum benefit from the exercise you should try to write it from
    scratch and just use the earlier one if you get stuck. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">step_deterministic</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">deterministic</span> <span class="id" type="var">step</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
<a name="lab593"></a><h2 class="section">Strong Progress and Normal Forms</h2>

<div class="paragraph"> </div>

 The definition of single-step reduction for our toy language is
    fairly simple, but for a larger language it would be pretty easy
    to forget one of the rules and create a situation where some term
    cannot take a step even though it has not been completely reduced
    to a value.  The following theorem shows that we did not, in fact,
    make such a mistake here. 
<div class="paragraph"> </div>

 <i>Theorem</i> (<i>Strong Progress</i>): If <span class="inlinecode"><span class="id" type="var">t</span></span> is a term, then either <span class="inlinecode"><span class="id" type="var">t</span></span>
    is a value, or there exists a term <span class="inlinecode"><span class="id" type="var">t'</span></span> such that <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span>. 
<div class="paragraph"> </div>

 <i>Proof</i>: By induction on <span class="inlinecode"><span class="id" type="var">t</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> Suppose <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n</span></span>. Then <span class="inlinecode"><span class="id" type="var">t</span></span> is a <span class="inlinecode"><span class="id" type="var">value</span></span>.

<div class="paragraph"> </div>


</li>
<li> Suppose <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span>, where (by the IH) <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> is either a
      value or can step to some <span class="inlinecode"><span class="id" type="var">t<sub>1</sub>'</span></span>, and where <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> is either a
      value or can step to some <span class="inlinecode"><span class="id" type="var">t<sub>2</sub>'</span></span>. We must show <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> is
      either a value or steps to some <span class="inlinecode"><span class="id" type="var">t'</span></span>.

<div class="paragraph"> </div>

<ul class="doclist">
<li> If <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> are both values, then <span class="inlinecode"><span class="id" type="var">t</span></span> can take a step, by
        <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span>.

<div class="paragraph"> </div>


</li>
<li> If <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> is a value and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> can take a step, then so can <span class="inlinecode"><span class="id" type="var">t</span></span>,
        by <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span>.

<div class="paragraph"> </div>


</li>
<li> If <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> can take a step, then so can <span class="inlinecode"><span class="id" type="var">t</span></span>, by <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span>.  <font size=-2>&#9744;</font> 
</li>
</ul>

</li>
</ul>

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">strong_progress</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&or;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">t'</span>, <span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t'</span>).<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">tm_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">t</span>) <span class="id" type="var">Case</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "C". <span class="id" type="var">left</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">v_const</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "P". <span class="id" type="var">right</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">IHt1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "l". <span class="id" type="tactic">inversion</span> <span class="id" type="var">IHt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "l". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">C</span> (<span class="id" type="var">n</span> + <span class="id" type="var">n0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SSCase</span> "r". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">H1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "r". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">H0</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">P</span> <span class="id" type="var">t'</span> <span class="id" type="var">t<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
This important property is called <i>strong progress</i>, because
    every term either is a value or can "make progress" by stepping to
    some other term.  (The qualifier "strong" distinguishes it from a
    more refined version that we'll see in later chapters, called
    simply "progress.") 
<div class="paragraph"> </div>

 The idea of "making progress" can be extended to tell us something
    interesting about <span class="inlinecode"><span class="id" type="var">value</span></span>s: in this language <span class="inlinecode"><span class="id" type="var">value</span></span>s are exactly
    the terms that <i>cannot</i> make progress in this sense.  

<div class="paragraph"> </div>

    To state this observation formally, let's begin by giving a name
    to terms that cannot make progress.  We'll call them <i>normal
    forms</i>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">normal_form</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} (<span class="id" type="var">R</span>:<span class="id" type="var">relation</span> <span class="id" type="var">X</span>) (<span class="id" type="var">t</span>:<span class="id" type="var">X</span>) : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;¬ <span style="font-family: arial;">&exist;</span><span class="id" type="var">t'</span>, <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>.<br/>

<br/>
</div>

<div class="doc">
This definition actually specifies what it is to be a normal form
    for an <i>arbitrary</i> relation <span class="inlinecode"><span class="id" type="var">R</span></span> over an arbitrary set <span class="inlinecode"><span class="id" type="var">X</span></span>, not
    just for the particular single-step reduction relation over terms
    that we are interested in at the moment.  We'll re-use the same
    terminology for talking about other relations later in the
    course. 
<div class="paragraph"> </div>

 We can use this terminology to generalize the observation we made
    in the strong progress theorem: in this language, normal forms and
    values are actually the same thing. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">value_is_nf</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">v</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">v</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">normal_form</span> <span class="id" type="var">step</span> <span class="id" type="var">v</span>.<br/>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">normal_form</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">contra</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">contra</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nf_is_value</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">normal_form</span> <span class="id" type="var">step</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">value</span> <span class="id" type="var">t</span>.<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" type="keyword">Proof</span>. <span class="comment">(*&nbsp;a&nbsp;corollary&nbsp;of&nbsp;<span class="inlinecode"><span class="id" type="var">strong_progress</span></span>...&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">normal_form</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="var">G</span> : <span class="id" type="var">value</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&or;</span> <span style="font-family: arial;">&exist;</span><span class="id" type="var">t'</span>, <span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "Proof of assertion". <span class="id" type="tactic">apply</span> <span class="id" type="var">strong_progress</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">G</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "l". <span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "r". <span class="id" type="tactic">apply</span> <span class="id" type="var">ex_falso_quodlibet</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" type="keyword">Corollary</span> <span class="id" type="var">nf_same_as_value</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">normal_form</span> <span class="id" type="var">step</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&harr;</span> <span class="id" type="var">value</span> <span class="id" type="var">t</span>.<br/>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">nf_is_value</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">value_is_nf</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
Why is this interesting?  

<div class="paragraph"> </div>

    Because <span class="inlinecode"><span class="id" type="var">value</span></span> is a syntactic concept &mdash; it is defined by looking
    at the form of a term &mdash; while <span class="inlinecode"><span class="id" type="var">normal_form</span></span> is a semantic one &mdash;
    it is defined by looking at how the term steps.  It is not obvious
    that these concepts should coincide!

<div class="paragraph"> </div>

    Indeed, we could easily have written the definitions so that they
    would not coincide... 
</div>
<div class="code code-tight">

<br/>

<br/>
</div>

<div class="doc">
We might, for example, mistakenly define <span class="inlinecode"><span class="id" type="var">value</span></span> so that it
    includes some terms that are not finished reducing. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Temp1</span>.<br/>
<span class="comment">(*&nbsp;Open&nbsp;an&nbsp;inner&nbsp;module&nbsp;so&nbsp;we&nbsp;can&nbsp;redefine&nbsp;value&nbsp;and&nbsp;step.&nbsp;*)</span><br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">value</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
| <span class="id" type="var">v_const</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>, <span class="id" type="var">value</span> (<span class="id" type="var">C</span> <span class="id" type="var">n</span>)<br/>
| <span class="id" type="var">v_funny</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">n2</span>,                       <span class="comment">(*&nbsp;&lt;----&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">value</span> (<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>)).<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_PlusConstConst</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>) <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">C</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub>'</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab594"></a><h4 class="section">Exercise: 3 stars, advanced (value_not_same_as_normal_form)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">value_not_same_as_normal_form</span> :<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">v</span>, <span class="id" type="var">value</span> <span class="id" type="var">v</span> <span style="font-family: arial;">&and;</span> ¬ <span class="id" type="var">normal_form</span> <span class="id" type="var">step</span> <span class="id" type="var">v</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
Alternatively, we might mistakenly define <span class="inlinecode"><span class="id" type="var">step</span></span> so that it
    permits something designated as a value to reduce further. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Temp2</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">value</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
| <span class="id" type="var">v_const</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>, <span class="id" type="var">value</span> (<span class="id" type="var">C</span> <span class="id" type="var">n</span>).<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Funny</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>,                         <span class="comment">(*&nbsp;&lt;----&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">C</span> <span class="id" type="var">n</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n</span>) (<span class="id" type="var">C</span> 0)<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_PlusConstConst</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>) <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">C</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub>'</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab595"></a><h4 class="section">Exercise: 2 stars, advanced (value_not_same_as_normal_form)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">value_not_same_as_normal_form</span> :<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">v</span>, <span class="id" type="var">value</span> <span class="id" type="var">v</span> <span style="font-family: arial;">&and;</span> ¬ <span class="id" type="var">normal_form</span> <span class="id" type="var">step</span> <span class="id" type="var">v</span>.<br/>
<div class="togglescript" id="proofcontrol11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')"><span class="show"></span></div>
<div class="proofscript" id="proof11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>

<br/>
</div>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
Finally, we might define <span class="inlinecode"><span class="id" type="var">value</span></span> and <span class="inlinecode"><span class="id" type="var">step</span></span> so that there is some
    term that is not a value but that cannot take a step in the <span class="inlinecode"><span class="id" type="var">step</span></span>
    relation.  Such terms are said to be <i>stuck</i>. In this case this is
    caused by a mistake in the semantics, but we will also see
    situations where, even in a correct language definition, it makes
    sense to allow some terms to be stuck. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Temp3</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">value</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">v_const</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>, <span class="id" type="var">value</span> (<span class="id" type="var">C</span> <span class="id" type="var">n</span>).<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_PlusConstConst</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>) <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">C</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
</div>

<div class="doc">
(Note that <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span> is missing.) 
<div class="paragraph"> </div>

<a name="lab596"></a><h4 class="section">Exercise: 3 stars, advanced (value_not_same_as_normal_form')</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">value_not_same_as_normal_form</span> :<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">t</span>, ¬ <span class="id" type="var">value</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">normal_form</span> <span class="id" type="var">step</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Temp3</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab597"></a><h3 class="section">Additional Exercises</h3>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Temp4</span>.<br/>

<br/>
</div>

<div class="doc">
Here is another very simple language whose terms, instead of being
    just plus and numbers, are just the booleans true and false and a
    conditional expression... 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">tm</span> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ttrue</span> : <span class="id" type="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">tfalse</span> : <span class="id" type="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">tif</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">value</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">v_true</span> : <span class="id" type="var">value</span> <span class="id" type="var">ttrue</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">v_false</span> : <span class="id" type="var">value</span> <span class="id" type="var">tfalse</span>.<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_IfTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_IfFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">tfalse</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_If</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">tif</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab598"></a><h4 class="section">Exercise: 1 star (smallstep_bools)</h4>
 Which of the following propositions are provable?  (This is just a
    thought exercise, but for an extra challenge feel free to prove
    your answers in Coq.) 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">bool_step_prop1</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">tfalse</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">tfalse</span>.<br/>

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">bool_step_prop2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ttrue</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tif</span> <span class="id" type="var">tfalse</span> <span class="id" type="var">tfalse</span> <span class="id" type="var">tfalse</span>)<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ttrue</span>.<br/>

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">bool_step_prop3</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span><br/>
&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ttrue</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span>.<br/>

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab599"></a><h4 class="section">Exercise: 3 stars, optional (progress_bool)</h4>
 Just as we proved a progress theorem for plus expressions, we can
    do so for boolean expressions, as well. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">strong_progress</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&or;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">t'</span>, <span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab600"></a><h4 class="section">Exercise: 2 stars, optional (step_deterministic)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">step_deterministic</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">deterministic</span> <span class="id" type="var">step</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Temp5</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab601"></a><h4 class="section">Exercise: 2 stars (smallstep_bool_shortcut)</h4>
 Suppose we want to add a "short circuit" to the step relation for
    boolean expressions, so that it can recognize when the <span class="inlinecode"><span class="id" type="keyword">then</span></span> and
    <span class="inlinecode"><span class="id" type="keyword">else</span></span> branches of a conditional are the same value (either
    <span class="inlinecode"><span class="id" type="var">ttrue</span></span> or <span class="inlinecode"><span class="id" type="var">tfalse</span></span>) and reduce the whole conditional to this
    value in a single step, even if the guard has not yet been reduced
    to a value. For example, we would like this proposition to be
    provable: 

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tif</span>&nbsp;<span class="id" type="var">ttrue</span>&nbsp;<span class="id" type="var">ttrue</span>&nbsp;<span class="id" type="var">ttrue</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span>.
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

 Write an extra clause for the step relation that achieves this
    effect and prove <span class="inlinecode"><span class="id" type="var">bool_step_prop4</span></span>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_IfTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_IfFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">tfalse</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_If</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">tif</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span><br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">bool_step_prop4</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">ttrue</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tfalse</span>.<br/>

<br/>
<span class="id" type="keyword">Example</span> <span class="id" type="var">bool_step_prop4_holds</span> : <br/>
&nbsp;&nbsp;<span class="id" type="var">bool_step_prop4</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab602"></a><h4 class="section">Exercise: 3 stars, optional (properties_of_altered_step)</h4>
 It can be shown that the determinism and strong progress theorems
    for the step relation in the lecture notes also hold for the
    definition of step given above.  After we add the clause
    <span class="inlinecode"><span class="id" type="var">ST_ShortCircuit</span></span>...

<div class="paragraph"> </div>

<ul class="doclist">
<li> Is the <span class="inlinecode"><span class="id" type="var">step</span></span> relation still deterministic?  Write yes or no and
      briefly (1 sentence) explain your answer.

<div class="paragraph"> </div>

      Optional: prove your answer correct in Coq.

</li>
</ul>

</div>
<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

<ul class="doclist">
<li> Does a strong progress theorem hold? Write yes or no and
     briefly (1 sentence) explain your answer.

<div class="paragraph"> </div>

     Optional: prove your answer correct in Coq.

</li>
</ul>

</div>
<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

<ul class="doclist">
<li> In general, is there any way we could cause strong progress to
     fail if we took away one or more constructors from the original
     step relation? Write yes or no and briefly (1 sentence) explain
     your answer.

</li>
</ul>

<div class="paragraph"> </div>

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
 <font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Temp5</span>.<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Temp4</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab603"></a><h1 class="section">Multi-Step Reduction</h1>

<div class="paragraph"> </div>

 Until now, we've been working with the <i>single-step reduction</i>
    relation <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span>, which formalizes the individual steps of an
    <i>abstract machine</i> for executing programs.  

<div class="paragraph"> </div>

    We can also use this machine to reduce programs to completion &mdash;
    to find out what final result they yield.  This can be formalized
    as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> First, we define a <i>multi-step reduction relation</i> <span class="inlinecode"><span style="font-family: arial;">&rArr;*</span></span>, which
      relates terms <span class="inlinecode"><span class="id" type="var">t</span></span> and <span class="inlinecode"><span class="id" type="var">t'</span></span> if <span class="inlinecode"><span class="id" type="var">t</span></span> can reach <span class="inlinecode"><span class="id" type="var">t'</span></span> by any number
      of single reduction steps (including zero steps!).

<div class="paragraph"> </div>


</li>
<li> Then we define a "result" of a term <span class="inlinecode"><span class="id" type="var">t</span></span> as a normal form that
      <span class="inlinecode"><span class="id" type="var">t</span></span> can reach by multi-step reduction. 
</li>
</ul>

</div>
<div class="code code-tight">

<br/>

<br/>
</div>

<div class="doc">
Since we'll want to reuse the idea of multi-step reduction many
    times in this and future chapters, let's take a little extra
    trouble here and define it generically.  

<div class="paragraph"> </div>

    Given a relation <span class="inlinecode"><span class="id" type="var">R</span></span>, we define a relation <span class="inlinecode"><span class="id" type="var">multi</span></span> <span class="inlinecode"><span class="id" type="var">R</span></span>, called the
    <i>multi-step closure of <span class="inlinecode"><span class="id" type="var">R</span></span></i> as follows: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">multi</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} (<span class="id" type="var">R</span>: <span class="id" type="var">relation</span> <span class="id" type="var">X</span>) : <span class="id" type="var">relation</span> <span class="id" type="var">X</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">multi_refl</span>  : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">x</span> : <span class="id" type="var">X</span>), <span class="id" type="var">multi</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">multi_step</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span> : <span class="id" type="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multi</span> <span class="id" type="var">R</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multi</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">z</span>.<br/>

<br/>
</div>

<div class="doc">
The effect of this definition is that <span class="inlinecode"><span class="id" type="var">multi</span></span> <span class="inlinecode"><span class="id" type="var">R</span></span> relates two
    elements <span class="inlinecode"><span class="id" type="var">x</span></span> and <span class="inlinecode"><span class="id" type="var">y</span></span> if either 

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" type="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">y</span></span>, or else

</li>
<li> there is some sequence <span class="inlinecode"><span class="id" type="var">z1</span></span>, <span class="inlinecode"><span class="id" type="var">z2</span></span>, ..., <span class="inlinecode"><span class="id" type="var">zn</span></span>
         such that

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;<span class="id" type="var">R</span>&nbsp;<span class="id" type="var">x</span>&nbsp;<span class="id" type="var">z1</span><br/>
&nbsp;&nbsp;<span class="id" type="var">R</span>&nbsp;<span class="id" type="var">z1</span>&nbsp;<span class="id" type="var">z2</span><br/>
&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;<span class="id" type="var">R</span>&nbsp;<span class="id" type="var">zn</span>&nbsp;<span class="id" type="var">y</span>.
<div class="paragraph"> </div>

</div>

</li>
</ul>

<div class="paragraph"> </div>

    Thus, if <span class="inlinecode"><span class="id" type="var">R</span></span> describes a single-step of computation, <span class="inlinecode"><span class="id" type="var">z1</span></span>,
    ... <span class="inlinecode"><span class="id" type="var">zn</span></span> is the sequence of intermediate steps of computation
    between <span class="inlinecode"><span class="id" type="var">x</span></span> and <span class="inlinecode"><span class="id" type="var">y</span></span>.

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Tactic Notation</span> "multi_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "multi_refl" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "multi_step" ].<br/>

<br/>
</div>

<div class="doc">
We write <span class="inlinecode"><span style="font-family: arial;">&rArr;*</span></span> for the <span class="inlinecode"><span class="id" type="var">multi</span></span> <span class="inlinecode"><span class="id" type="var">step</span></span> relation &mdash; i.e., the
    relation that relates two terms <span class="inlinecode"><span class="id" type="var">t</span></span> and <span class="inlinecode"><span class="id" type="var">t'</span></span> if we can get from
    <span class="inlinecode"><span class="id" type="var">t</span></span> to <span class="inlinecode"><span class="id" type="var">t'</span></span> using the <span class="inlinecode"><span class="id" type="var">step</span></span> relation zero or more times. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Notation</span> " t '<span style="font-family: arial;">&rArr;*</span>' t' " := (<span class="id" type="var">multi</span> <span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
</div>

<div class="doc">
The relation <span class="inlinecode"><span class="id" type="var">multi</span></span> <span class="inlinecode"><span class="id" type="var">R</span></span> has several crucial properties.

<div class="paragraph"> </div>

    First, it is obviously <i>reflexive</i> (that is, <span class="inlinecode"><span style="font-family: arial;">&forall;</span></span> <span class="inlinecode"><span class="id" type="var">x</span>,</span> <span class="inlinecode"><span class="id" type="var">multi</span></span> <span class="inlinecode"><span class="id" type="var">R</span></span> <span class="inlinecode"><span class="id" type="var">x</span></span>
    <span class="inlinecode"><span class="id" type="var">x</span></span>).  In the case of the <span class="inlinecode"><span style="font-family: arial;">&rArr;*</span></span> (i.e. <span class="inlinecode"><span class="id" type="var">multi</span></span> <span class="inlinecode"><span class="id" type="var">step</span></span>) relation, the
    intuition is that a term can execute to itself by taking zero
    steps of execution.

<div class="paragraph"> </div>

    Second, it contains <span class="inlinecode"><span class="id" type="var">R</span></span> &mdash; that is, single-step executions are a
    particular case of multi-step executions.  (It is this fact that
    justifies the word "closure" in the term "multi-step closure of
    <span class="inlinecode"><span class="id" type="var">R</span></span>.") 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">multi_R</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>) (<span class="id" type="var">R</span>:<span class="id" type="var">relation</span> <span class="id" type="var">X</span>) (<span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span style="font-family: arial;">&rarr;</span> (<span class="id" type="var">multi</span> <span class="id" type="var">R</span>) <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">X</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">multi_refl</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Third, <span class="inlinecode"><span class="id" type="var">multi</span></span> <span class="inlinecode"><span class="id" type="var">R</span></span> is <i>transitive</i>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">multi_trans</span> :<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&forall;</span>(<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>) (<span class="id" type="var">R</span>: <span class="id" type="var">relation</span> <span class="id" type="var">X</span>) (<span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span> : <span class="id" type="var">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multi</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multi</span> <span class="id" type="var">R</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multi</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">z</span>.<br/>
<div class="togglescript" id="proofcontrol12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')"><span class="show"></span></div>
<div class="proofscript" id="proof12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">X</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">multi_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">G</span>) <span class="id" type="var">Case</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "multi_refl". <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "multi_step".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHG</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
That is, if <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span><span style="font-family: arial;">&rArr;*</span><span class="id" type="var">t<sub>2</sub></span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span><span style="font-family: arial;">&rArr;*</span><span class="id" type="var">t<sub>3</sub></span></span>, then <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span><span style="font-family: arial;">&rArr;*</span><span class="id" type="var">t<sub>3</sub></span></span>. 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
<a name="lab604"></a><h2 class="section">Examples</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">test_multistep_1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 0) (<span class="id" type="var">C</span> 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 2) (<span class="id" type="var">C</span> 4))<br/>
&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;*</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">C</span> ((0 + 3) + (2 + 4)).<br/>
<div class="togglescript" id="proofcontrol13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')"><span class="show"></span></div>
<div class="proofscript" id="proof13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_step</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> (0 + 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 2) (<span class="id" type="var">C</span> 4))).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_step</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> (0 + 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> (2 + 4))).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">v_const</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_R</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
Here's an alternate proof that uses <span class="inlinecode"><span class="id" type="tactic">eapply</span></span> to avoid explicitly
    constructing all the intermediate terms. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">test_multistep_1'</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 0) (<span class="id" type="var">C</span> 3))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 2) (<span class="id" type="var">C</span> 4))<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&rArr;*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">C</span> ((0 + 3) + (2 + 4)).<br/>
<div class="togglescript" id="proofcontrol14" onclick="toggleDisplay('proof14');toggleDisplay('proofcontrol14')"><span class="show"></span></div>
<div class="proofscript" id="proof14" onclick="toggleDisplay('proof14');toggleDisplay('proofcontrol14')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">v_const</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_refl</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
<a name="lab605"></a><h4 class="section">Exercise: 1 star, optional (test_multistep_2)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">test_multistep_2</span>:<br/>
&nbsp;&nbsp;<span class="id" type="var">C</span> 3 <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">C</span> 3.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab606"></a><h4 class="section">Exercise: 1 star, optional (test_multistep_3)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">test_multistep_3</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 0) (<span class="id" type="var">C</span> 3)<br/>
&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 0) (<span class="id" type="var">C</span> 3).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab607"></a><h4 class="section">Exercise: 2 stars (test_multistep_4)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">test_multistep_4</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> 2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> 0) (<span class="id" type="var">C</span> 3)))<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&rArr;*</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">C</span> (2 + (0 + 3))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
<a name="lab608"></a><h2 class="section">Normal Forms Again</h2>

<div class="paragraph"> </div>

 If <span class="inlinecode"><span class="id" type="var">t</span></span> reduces to <span class="inlinecode"><span class="id" type="var">t'</span></span> in zero or more steps and <span class="inlinecode"><span class="id" type="var">t'</span></span> is a
    normal form, we say that "<span class="inlinecode"><span class="id" type="var">t'</span></span> is a normal form of <span class="inlinecode"><span class="id" type="var">t</span></span>." 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">step_normal_form</span> := <span class="id" type="var">normal_form</span> <span class="id" type="var">step</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">normal_form_of</span> (<span class="id" type="var">t</span> <span class="id" type="var">t'</span> : <span class="id" type="var">tm</span>) :=<br/>
&nbsp;&nbsp;(<span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">t'</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">step_normal_form</span> <span class="id" type="var">t'</span>).<br/>

<br/>
</div>

<div class="doc">
We have already seen that, for our language, single-step reduction is
    deterministic &mdash; i.e., a given term can take a single step in
    at most one way.  It follows from this that, if <span class="inlinecode"><span class="id" type="var">t</span></span> can reach
    a normal form, then this normal form is unique.  In other words, we
    can actually pronounce <span class="inlinecode"><span class="id" type="var">normal_form</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span> as "<span class="inlinecode"><span class="id" type="var">t'</span></span> is <i>the</i>
    normal form of <span class="inlinecode"><span class="id" type="var">t</span></span>." 
<div class="paragraph"> </div>

<a name="lab609"></a><h4 class="section">Exercise: 3 stars, optional (normal_forms_unique)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">normal_forms_unique</span>:<br/>
&nbsp;&nbsp;<span class="id" type="var">deterministic</span> <span class="id" type="var">normal_form_of</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">deterministic</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">normal_form_of</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">P1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">P11</span> <span class="id" type="var">P12</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">P1</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">P2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">P21</span> <span class="id" type="var">P22</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">P2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">y2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;recommend&nbsp;using&nbsp;this&nbsp;initial&nbsp;setup&nbsp;as-is!&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

 Indeed, something stronger is true for this language (though not
    for all languages): the reduction of <i>any</i> term <span class="inlinecode"><span class="id" type="var">t</span></span> will
    eventually reach a normal form &mdash; i.e., <span class="inlinecode"><span class="id" type="var">normal_form_of</span></span> is a
    <i>total</i> function.  Formally, we say the <span class="inlinecode"><span class="id" type="var">step</span></span> relation is
    <i>normalizing</i>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">normalizing</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} (<span class="id" type="var">R</span>:<span class="id" type="var">relation</span> <span class="id" type="var">X</span>) :=<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span>, <span style="font-family: arial;">&exist;</span><span class="id" type="var">t'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">multi</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">normal_form</span> <span class="id" type="var">R</span> <span class="id" type="var">t'</span>.<br/>

<br/>
</div>

<div class="doc">
To prove that <span class="inlinecode"><span class="id" type="var">step</span></span> is normalizing, we need a couple of lemmas.

<div class="paragraph"> </div>

    First, we observe that, if <span class="inlinecode"><span class="id" type="var">t</span></span> reduces to <span class="inlinecode"><span class="id" type="var">t'</span></span> in many steps, then
    the same sequence of reduction steps within <span class="inlinecode"><span class="id" type="var">t</span></span> is also possible
    when <span class="inlinecode"><span class="id" type="var">t</span></span> appears as the left-hand child of a <span class="inlinecode"><span class="id" type="var">P</span></span> node, and
    similarly when <span class="inlinecode"><span class="id" type="var">t</span></span> appears as the right-hand child of a <span class="inlinecode"><span class="id" type="var">P</span></span>
    node whose left-hand child is a value. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">multistep_congr_1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>.<br/>
<div class="togglescript" id="proofcontrol15" onclick="toggleDisplay('proof15');toggleDisplay('proofcontrol15')"><span class="show"></span></div>
<div class="proofscript" id="proof15" onclick="toggleDisplay('proof15');toggleDisplay('proofcontrol15')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">H</span>. <span class="id" type="var">multi_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>) <span class="id" type="var">Case</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "multi_refl". <span class="id" type="tactic">apply</span> <span class="id" type="var">multi_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "multi_step". <span class="id" type="tactic">apply</span> <span class="id" type="var">multi_step</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">P</span> <span class="id" type="var">y</span> <span class="id" type="var">t<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ST_Plus1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHmulti</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
<a name="lab610"></a><h4 class="section">Exercise: 2 stars (multistep_congr_2)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">multistep_congr_2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">t<sub>2</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub>'</span>.<br/>
<div class="togglescript" id="proofcontrol16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')"><span class="show"></span></div>
<div class="proofscript" id="proof16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

 <i>Theorem</i>: The <span class="inlinecode"><span class="id" type="var">step</span></span> function is normalizing &mdash; i.e., for every
    <span class="inlinecode"><span class="id" type="var">t</span></span> there exists some <span class="inlinecode"><span class="id" type="var">t'</span></span> such that <span class="inlinecode"><span class="id" type="var">t</span></span> steps to <span class="inlinecode"><span class="id" type="var">t'</span></span> and <span class="inlinecode"><span class="id" type="var">t'</span></span> is
    a normal form.

<div class="paragraph"> </div>

    <i>Proof sketch</i>: By induction on terms.  There are two cases to
    consider:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n</span></span> for some <span class="inlinecode"><span class="id" type="var">n</span></span>.  Here <span class="inlinecode"><span class="id" type="var">t</span></span> doesn't take a step,
      and we have <span class="inlinecode"><span class="id" type="var">t'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">t</span></span>.  We can derive the left-hand side by
      reflexivity and the right-hand side by observing (a) that values
      are normal forms (by <span class="inlinecode"><span class="id" type="var">nf_same_as_value</span></span>) and (b) that <span class="inlinecode"><span class="id" type="var">t</span></span> is a
      value (by <span class="inlinecode"><span class="id" type="var">v_const</span></span>).

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> for some <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span>.  By the IH, <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> and
      <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> have normal forms <span class="inlinecode"><span class="id" type="var">t<sub>1</sub>'</span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub>'</span></span>.  Recall that normal
      forms are values (by <span class="inlinecode"><span class="id" type="var">nf_same_as_value</span></span>); we know that <span class="inlinecode"><span class="id" type="var">t<sub>1</sub>'</span></span> <span class="inlinecode">=</span>
      <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n1</span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub>'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n2</span></span>, for some <span class="inlinecode"><span class="id" type="var">n1</span></span> and <span class="inlinecode"><span class="id" type="var">n2</span></span>.
      We can combine the <span class="inlinecode"><span style="font-family: arial;">&rArr;*</span></span> derivations for <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> to prove
      that <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span> reduces in many steps to <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode">(<span class="id" type="var">n1</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" type="var">n2</span>)</span>.

<div class="paragraph"> </div>

      It is clear that our choice of <span class="inlinecode"><span class="id" type="var">t'</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode">(<span class="id" type="var">n1</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" type="var">n2</span>)</span> is a
      value, which is in turn a normal form. <font size=-2>&#9744;</font> 
</li>
</ul>

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">step_normalizing</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">normalizing</span> <span class="id" type="var">step</span>.<br/>
<div class="togglescript" id="proofcontrol17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')"><span class="show"></span></div>
<div class="proofscript" id="proof17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">normalizing</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">tm_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">t</span>) <span class="id" type="var">Case</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "C".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">C</span> <span class="id" type="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "l". <span class="id" type="tactic">apply</span> <span class="id" type="var">multi_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "r".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;can&nbsp;use&nbsp;<span class="inlinecode"><span class="id" type="tactic">rewrite</span></span>&nbsp;with&nbsp;"iff"&nbsp;statements,&nbsp;not<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;just&nbsp;equalities:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">nf_same_as_value</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">v_const</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "P".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">IHt1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">IHt1</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">IHt2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t<sub>2</sub>'</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">IHt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H11</span> <span class="id" type="var">H12</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H21</span> <span class="id" type="var">H22</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">nf_same_as_value</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H12</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nf_same_as_value</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H22</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n1</span>]. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H22</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H21</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">C</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "l".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) <span class="id" type="var">t<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multistep_congr_1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H11</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_trans</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multistep_congr_2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">v_const</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H21</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_R</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ST_PlusConstConst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "r".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">nf_same_as_value</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">v_const</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
<a name="lab611"></a><h2 class="section">Equivalence of Big-Step and Small-Step Reduction</h2>

<div class="paragraph"> </div>

 Having defined the operational semantics of our tiny programming
    language in two different styles, it makes sense to ask whether
    these definitions actually define the same thing!  They do, though
    it takes a little work to show it.  (The details are left as an
    exercise). 
<div class="paragraph"> </div>

<a name="lab612"></a><h4 class="section">Exercise: 3 stars (eval__multistep)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">eval__multistep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span> <span class="id" type="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">t</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">C</span> <span class="id" type="var">n</span>.<br/>

<br/>
</div>

<div class="doc">
The key idea behind the proof comes from the following picture:

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span>&nbsp;<span class="id" type="var">t<sub>1</sub></span>&nbsp;<span class="id" type="var">t<sub>2</sub></span>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">by</span>&nbsp;<span class="id" type="var">ST_Plus1</span>)&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span>&nbsp;<span class="id" type="var">t<sub>1</sub>'</span>&nbsp;<span class="id" type="var">t<sub>2</sub></span>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">by</span>&nbsp;<span class="id" type="var">ST_Plus1</span>)&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span>&nbsp;<span class="id" type="var">t<sub>1</sub>''</span>&nbsp;<span class="id" type="var">t<sub>2</sub></span>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">by</span>&nbsp;<span class="id" type="var">ST_Plus1</span>)&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span>&nbsp;(<span class="id" type="var">C</span>&nbsp;<span class="id" type="var">n1</span>)&nbsp;<span class="id" type="var">t<sub>2</sub></span>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">by</span>&nbsp;<span class="id" type="var">ST_Plus2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span>&nbsp;(<span class="id" type="var">C</span>&nbsp;<span class="id" type="var">n1</span>)&nbsp;<span class="id" type="var">t<sub>2</sub>'</span>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">by</span>&nbsp;<span class="id" type="var">ST_Plus2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span>&nbsp;(<span class="id" type="var">C</span>&nbsp;<span class="id" type="var">n1</span>)&nbsp;<span class="id" type="var">t<sub>2</sub>''</span>&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">by</span>&nbsp;<span class="id" type="var">ST_Plus2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span>&nbsp;(<span class="id" type="var">C</span>&nbsp;<span class="id" type="var">n1</span>)&nbsp;(<span class="id" type="var">C</span>&nbsp;<span class="id" type="var">n2</span>)&nbsp;<span style="font-family: arial;">&rArr;</span>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">by</span>&nbsp;<span class="id" type="var">ST_PlusConstConst</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">C</span>&nbsp;(<span class="id" type="var">n1</span>&nbsp;+&nbsp;<span class="id" type="var">n2</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<div class="paragraph"> </div>

</div>
    That is, the multistep reduction of a term of the form <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span>
    proceeds in three phases:

<div class="paragraph"> </div>

<ul class="doclist">
<li> First, we use <span class="inlinecode"><span class="id" type="var">ST_Plus1</span></span> some number of times to reduce <span class="inlinecode"><span class="id" type="var">t<sub>1</sub></span></span>
         to a normal form, which must (by <span class="inlinecode"><span class="id" type="var">nf_same_as_value</span></span>) be a
         term of the form <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n1</span></span> for some <span class="inlinecode"><span class="id" type="var">n1</span></span>.

</li>
<li> Next, we use <span class="inlinecode"><span class="id" type="var">ST_Plus2</span></span> some number of times to reduce <span class="inlinecode"><span class="id" type="var">t<sub>2</sub></span></span>
         to a normal form, which must again be a term of the form <span class="inlinecode"><span class="id" type="var">C</span></span>
         <span class="inlinecode"><span class="id" type="var">n2</span></span> for some <span class="inlinecode"><span class="id" type="var">n2</span></span>.

</li>
<li> Finally, we use <span class="inlinecode"><span class="id" type="var">ST_PlusConstConst</span></span> one time to reduce <span class="inlinecode"><span class="id" type="var">P</span></span> <span class="inlinecode">(<span class="id" type="var">C</span></span>
         <span class="inlinecode"><span class="id" type="var">n1</span>)</span> <span class="inlinecode">(<span class="id" type="var">C</span></span> <span class="inlinecode"><span class="id" type="var">n2</span>)</span> to <span class="inlinecode"><span class="id" type="var">C</span></span> <span class="inlinecode">(<span class="id" type="var">n1</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" type="var">n2</span>)</span>. 
</li>
</ul>

<div class="paragraph"> </div>

 To formalize this intuition, you'll need to use the congruence
    lemmas from above (you might want to review them now, so that
    you'll be able to recognize when they are useful), plus some basic
    properties of <span class="inlinecode"><span style="font-family: arial;">&rArr;*</span></span>: that it is reflexive, transitive, and
    includes <span class="inlinecode"><span style="font-family: arial;">&rArr;</span></span>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab613"></a><h4 class="section">Exercise: 3 stars, advanced (eval__multistep_inf)</h4>
 Write a detailed informal version of the proof of <span class="inlinecode"><span class="id" type="var">eval__multistep</span></span>.

<div class="paragraph"> </div>

<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
<font size=-2>&#9744;</font>
 For the other direction, we need one lemma, which establishes a
    relation between single-step reduction and big-step evaluation. 
<div class="paragraph"> </div>

<a name="lab614"></a><h4 class="section">Exercise: 3 stars (step__eval)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">step__eval</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t'</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">n</span> <span class="id" type="var">Hs</span>. <span class="id" type="tactic">generalize</span> <span class="id" type="tactic">dependent</span> <span class="id" type="var">n</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

 The fact that small-step reduction implies big-step is now
    straightforward to prove, once it is stated correctly. 

<div class="paragraph"> </div>

    The proof proceeds by induction on the multi-step reduction
    sequence that is buried in the hypothesis <span class="inlinecode"><span class="id" type="var">normal_form_of</span></span> <span class="inlinecode"><span class="id" type="var">t</span></span> <span class="inlinecode"><span class="id" type="var">t'</span></span>.  Make sure you understand the statement before you start to
    work on the proof.  
<div class="paragraph"> </div>

<a name="lab615"></a><h4 class="section">Exercise: 3 stars (multistep__eval)</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">multistep__eval</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span> <span class="id" type="var">t'</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">normal_form_of</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span style="font-family: arial;">&rarr;</span> <span style="font-family: arial;">&exist;</span><span class="id" type="var">n</span>, <span class="id" type="var">t'</span> = <span class="id" type="var">C</span> <span class="id" type="var">n</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
<a name="lab616"></a><h2 class="section">Additional Exercises</h2>

<div class="paragraph"> </div>

<a name="lab617"></a><h4 class="section">Exercise: 3 stars, optional (interp_tm)</h4>
 Remember that we also defined big-step evaluation of <span class="inlinecode"><span class="id" type="var">tm</span></span>s as a
    function <span class="inlinecode"><span class="id" type="var">evalF</span></span>.  Prove that it is equivalent to the existing
    semantics.

<div class="paragraph"> </div>

    Hint: we just proved that <span class="inlinecode"><span class="id" type="var">eval</span></span> and <span class="inlinecode"><span class="id" type="var">multistep</span></span> are
    equivalent, so logically it doesn't matter which you choose.
    One will be easier than the other, though!  
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">evalF_eval</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t</span> <span class="id" type="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">evalF</span> <span class="id" type="var">t</span> = <span class="id" type="var">n</span> <span style="font-family: arial;">&harr;</span> <span class="id" type="var">t</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">n</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab618"></a><h4 class="section">Exercise: 4 stars (combined_properties)</h4>
 We've considered the arithmetic and conditional expressions
    separately.  This exercise explores how the two interact. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Combined</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">tm</span> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">C</span> : <span class="id" type="var">nat</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">P</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ttrue</span> : <span class="id" type="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">tfalse</span> : <span class="id" type="var">tm</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">tif</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span>.<br/>
<div class="togglescript" id="proofcontrol18" onclick="toggleDisplay('proof18');toggleDisplay('proofcontrol18')"><span class="show"></span></div>
<div class="proofscript" id="proof18" onclick="toggleDisplay('proof18');toggleDisplay('proofcontrol18')">

<br/>
<span class="id" type="keyword">Tactic Notation</span> "tm_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "C" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "P"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ttrue" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tfalse" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "tif" ].<br/>
</div>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">value</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">v_const</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>, <span class="id" type="var">value</span> (<span class="id" type="var">C</span> <span class="id" type="var">n</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">v_true</span> : <span class="id" type="var">value</span> <span class="id" type="var">ttrue</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">v_false</span> : <span class="id" type="var">value</span> <span class="id" type="var">tfalse</span>.<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">step</span> : <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">tm</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_PlusConstConst</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> (<span class="id" type="var">C</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">C</span> <span class="id" type="var">n2</span>) <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">C</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_Plus2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">value</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span>     <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">P</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub>'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_IfTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">ttrue</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_IfFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">tfalse</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ST_If</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t<sub>1</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">t<sub>1</sub>'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tif</span> <span class="id" type="var">t<sub>1</sub></span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">tif</span> <span class="id" type="var">t<sub>1</sub>'</span> <span class="id" type="var">t<sub>2</sub></span> <span class="id" type="var">t<sub>3</sub></span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '<span style="font-family: arial;">&rArr;</span>' t' " := (<span class="id" type="var">step</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>
<div class="togglescript" id="proofcontrol19" onclick="toggleDisplay('proof19');toggleDisplay('proofcontrol19')"><span class="show"></span></div>
<div class="proofscript" id="proof19" onclick="toggleDisplay('proof19');toggleDisplay('proofcontrol19')">

<br/>
<span class="id" type="keyword">Tactic Notation</span> "step_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_PlusConstConst"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Plus1" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_Plus2"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_IfTrue" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_IfFalse" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ST_If" ].<br/>
</div>

<br/>
</div>

<div class="doc">
Earlier, we separately proved for both plus- and if-expressions...

<div class="paragraph"> </div>

<ul class="doclist">
<li> that the step relation was deterministic, and

<div class="paragraph"> </div>


</li>
<li> a strong progress lemma, stating that every term is either a
      value or can take a step.

</li>
</ul>
    Prove or disprove these two properties for the combined language. 
</div>
<div class="code code-tight">

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Combined</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab619"></a><h1 class="section">Small-Step Imp</h1>

<div class="paragraph"> </div>

 For a more serious example, here is the small-step version of the
    Imp operational semantics.  
<div class="paragraph"> </div>

 The small-step evaluation relations for arithmetic and boolean
    expressions are straightforward extensions of the tiny language
    we've been working up to now.  To make them easier to read, we
    introduce the symbolic notations <span class="inlinecode"><span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span></span> and <span class="inlinecode"><span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span></span>, respectively,
    for the arithmetic and boolean step relations. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">aval</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">av_num</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>, <span class="id" type="var">aval</span> (<span class="id" type="var">ANum</span> <span class="id" type="var">n</span>).<br/>

<br/>
</div>

<div class="doc">
We are not actually going to bother to define boolean
    values, since they aren't needed in the definition of <span class="inlinecode"><span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span></span>
    below (why?), though they might be if our language were a bit
    larger (why?). 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '/' st '<span style="font-family: arial;">&rArr;</span><sub>a</sub>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40, <span class="id" type="var">st</span> <span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 39).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">astep</span> : <span class="id" type="var">state</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Id</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">i</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">AId</span> <span class="id" type="var">i</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">ANum</span> (<span class="id" type="var">st</span> <span class="id" type="var">i</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Plus</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">APlus</span> (<span class="id" type="var">ANum</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">ANum</span> <span class="id" type="var">n2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">ANum</span> (<span class="id" type="var">n1</span> + <span class="id" type="var">n2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Plus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">APlus</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">APlus</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Plus2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span> <span class="id" type="var">a2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">aval</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">APlus</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">APlus</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Minus</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">AMinus</span> (<span class="id" type="var">ANum</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">ANum</span> <span class="id" type="var">n2</span>)) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">ANum</span> (<span class="id" type="var">minus</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Minus1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">AMinus</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">AMinus</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Minus2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span> <span class="id" type="var">a2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">aval</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">AMinus</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">AMinus</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Mult</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">AMult</span> (<span class="id" type="var">ANum</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">ANum</span> <span class="id" type="var">n2</span>)) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">ANum</span> (<span class="id" type="var">mult</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Mult1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">AMult</span> (<span class="id" type="var">a1</span>) (<span class="id" type="var">a2</span>)) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">AMult</span> (<span class="id" type="var">a1'</span>) (<span class="id" type="var">a2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">AS_Mult2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span> <span class="id" type="var">a2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">aval</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">AMult</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> (<span class="id" type="var">AMult</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2'</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '/' st '<span style="font-family: arial;">&rArr;</span><sub>a</sub>' t' " := (<span class="id" type="var">astep</span> <span class="id" type="var">st</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Reserved Notation</span> " t '/' st '<span style="font-family: arial;">&rArr;</span><sub>b</sub>' t' " (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40, <span class="id" type="var">st</span> <span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 39).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Inductive</span> <span class="id" type="var">bstep</span> : <span class="id" type="var">state</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_Eq</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BEq</span> (<span class="id" type="var">ANum</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">ANum</span> <span class="id" type="var">n2</span>)) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">if</span> (<span class="id" type="var">beq_nat</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>) <span class="id" type="keyword">then</span> <span class="id" type="var">BTrue</span> <span class="id" type="keyword">else</span> <span class="id" type="var">BFalse</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_Eq1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BEq</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> (<span class="id" type="var">BEq</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_Eq2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span> <span class="id" type="var">a2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">aval</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BEq</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> (<span class="id" type="var">BEq</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_LtEq</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BLe</span> (<span class="id" type="var">ANum</span> <span class="id" type="var">n1</span>) (<span class="id" type="var">ANum</span> <span class="id" type="var">n2</span>)) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">if</span> (<span class="id" type="var">ble_nat</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>) <span class="id" type="keyword">then</span> <span class="id" type="var">BTrue</span> <span class="id" type="keyword">else</span> <span class="id" type="var">BFalse</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_LtEq1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BLe</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> (<span class="id" type="var">BLe</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_LtEq2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span> <span class="id" type="var">a2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">aval</span> <span class="id" type="var">v<sub>1</sub></span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BLe</span> <span class="id" type="var">v<sub>1</sub></span> <span class="id" type="var">a2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> (<span class="id" type="var">BLe</span> <span class="id" type="var">v<sub>1</sub></span> (<span class="id" type="var">a2'</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_NotTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BNot</span> <span class="id" type="var">BTrue</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">BFalse</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_NotFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BNot</span> <span class="id" type="var">BFalse</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">BTrue</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_NotStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b1</span> <span class="id" type="var">b1'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">b1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">b1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BNot</span> <span class="id" type="var">b1</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> (<span class="id" type="var">BNot</span> <span class="id" type="var">b1'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_AndTrueTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BAnd</span> <span class="id" type="var">BTrue</span> <span class="id" type="var">BTrue</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">BTrue</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_AndTrueFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BAnd</span> <span class="id" type="var">BTrue</span> <span class="id" type="var">BFalse</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">BFalse</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_AndFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BAnd</span> <span class="id" type="var">BFalse</span> <span class="id" type="var">b2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">BFalse</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_AndTrueStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b2</span> <span class="id" type="var">b2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">b2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">b2'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BAnd</span> <span class="id" type="var">BTrue</span> <span class="id" type="var">b2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> (<span class="id" type="var">BAnd</span> <span class="id" type="var">BTrue</span> <span class="id" type="var">b2'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BS_AndStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b1</span> <span class="id" type="var">b1'</span> <span class="id" type="var">b2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">b1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">b1'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">BAnd</span> <span class="id" type="var">b1</span> <span class="id" type="var">b2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> (<span class="id" type="var">BAnd</span> <span class="id" type="var">b1'</span> <span class="id" type="var">b2</span>)<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '/' st '<span style="font-family: arial;">&rArr;</span><sub>b</sub>' t' " := (<span class="id" type="var">bstep</span> <span class="id" type="var">st</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>

<br/>
</div>

<div class="doc">
The semantics of commands is the interesting part.  We need two
    small tricks to make it work:

<div class="paragraph"> </div>

<ul class="doclist">
<li> We use <span class="inlinecode"><span class="id" type="var">SKIP</span></span> as a "command value" &mdash; i.e., a command that
         has reached a normal form.  

<div class="paragraph"> </div>

<ul class="doclist">
<li> An assignment command reduces to <span class="inlinecode"><span class="id" type="var">SKIP</span></span> (and an updated
              state).

<div class="paragraph"> </div>


</li>
<li> The sequencing command waits until its left-hand
              subcommand has reduced to <span class="inlinecode"><span class="id" type="var">SKIP</span></span>, then throws it away so
              that reduction can continue with the right-hand
              subcommand.

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> We reduce a <span class="inlinecode"><span class="id" type="var">WHILE</span></span> command by transforming it into a
         conditional followed by the same <span class="inlinecode"><span class="id" type="var">WHILE</span></span>.  
</li>
</ul>

<div class="paragraph"> </div>

 (There are other ways of achieving the effect of the latter
   trick, but they all share the feature that the original <span class="inlinecode"><span class="id" type="var">WHILE</span></span>
   command needs to be saved somewhere while a single copy of the loop
   body is being evaluated.) 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Reserved Notation</span> " t '/' st '<span style="font-family: arial;">&rArr;</span>' t' '/' st' " <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40, <span class="id" type="var">st</span> <span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 39, <span class="id" type="var">t'</span> <span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 39).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">cstep</span> : (<span class="id" type="var">com</span> × <span class="id" type="var">state</span>) <span style="font-family: arial;">&rarr;</span> (<span class="id" type="var">com</span> × <span class="id" type="var">state</span>) <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_AssStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">i</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">i</span> ::= <span class="id" type="var">a</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">i</span> ::= <span class="id" type="var">a'</span>) / <span class="id" type="var">st</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_Ass</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">i</span> <span class="id" type="var">n</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">i</span> ::= (<span class="id" type="var">ANum</span> <span class="id" type="var">n</span>)) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">SKIP</span> / (<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">i</span> <span class="id" type="var">n</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_SeqStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c1'</span> <span class="id" type="var">st'</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c1'</span> / <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">c1</span> ;; <span class="id" type="var">c2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">c1'</span> ;; <span class="id" type="var">c2</span>) / <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_SeqFinish</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">SKIP</span> ;; <span class="id" type="var">c2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c2</span> / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_IfTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IFB</span> <span class="id" type="var">BTrue</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c1</span> / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_IfFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IFB</span> <span class="id" type="var">BFalse</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c2</span> / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_IfStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">b</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">b'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IFB</span> <span class="id" type="var">b</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">IFB</span> <span class="id" type="var">b'</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_While</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b</span> <span class="id" type="var">c1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">WHILE</span> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c1</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">IFB</span> <span class="id" type="var">b</span> <span class="id" type="var">THEN</span> (<span class="id" type="var">c1</span>;; (<span class="id" type="var">WHILE</span> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c1</span> <span class="id" type="var">END</span>)) <span class="id" type="var">ELSE</span> <span class="id" type="var">SKIP</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '/' st '<span style="font-family: arial;">&rArr;</span>' t' '/' st' " := (<span class="id" type="var">cstep</span> (<span class="id" type="var">t</span>,<span class="id" type="var">st</span>) (<span class="id" type="var">t'</span>,<span class="id" type="var">st'</span>)).<br/>

<br/>
</div>

<div class="doc">
<a name="lab620"></a><h1 class="section">Concurrent Imp</h1>

<div class="paragraph"> </div>

 Finally, to show the power of this definitional style, let's
    enrich Imp with a new form of command that runs two subcommands in
    parallel and terminates when both have terminated.  To reflect the
    unpredictability of scheduling, the actions of the subcommands may
    be interleaved in any order, but they share the same memory and
    can communicate by reading and writing the same variables. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">CImp</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">com</span> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">CSkip</span> : <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CAss</span> : <span class="id" type="var">id</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CSeq</span> : <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CIf</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CWhile</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;New:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CPar</span> : <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span>.<br/>
<div class="togglescript" id="proofcontrol20" onclick="toggleDisplay('proof20');toggleDisplay('proofcontrol20')"><span class="show"></span></div>
<div class="proofscript" id="proof20" onclick="toggleDisplay('proof20');toggleDisplay('proofcontrol20')">

<br/>
<span class="id" type="keyword">Tactic Notation</span> "com_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "SKIP" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "::=" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> ";"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "IFB" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "WHILE" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "PAR" ].<br/>
</div>

<br/>
<span class="id" type="keyword">Notation</span> "'SKIP'" := <br/>
&nbsp;&nbsp;<span class="id" type="var">CSkip</span>.<br/>
<span class="id" type="keyword">Notation</span> "x '::=' a" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CAss</span> <span class="id" type="var">x</span> <span class="id" type="var">a</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 60).<br/>
<span class="id" type="keyword">Notation</span> "c1 ;; c2" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CSeq</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "'WHILE' b 'DO' c 'END'" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CWhile</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "'IFB' b 'THEN' c1 'ELSE' c2 'FI'" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CIf</span> <span class="id" type="var">b</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "'PAR' c1 'WITH' c2 'END'" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CPar</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">cstep</span> : (<span class="id" type="var">com</span> × <span class="id" type="var">state</span>)  <span style="font-family: arial;">&rarr;</span> (<span class="id" type="var">com</span> × <span class="id" type="var">state</span>) <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Old&nbsp;part&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_AssStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">i</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>a</sub></span> <span class="id" type="var">a'</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">i</span> ::= <span class="id" type="var">a</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">i</span> ::= <span class="id" type="var">a'</span>) / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_Ass</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">i</span> <span class="id" type="var">n</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">i</span> ::= (<span class="id" type="var">ANum</span> <span class="id" type="var">n</span>)) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">SKIP</span> / (<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">i</span> <span class="id" type="var">n</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_SeqStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c1'</span> <span class="id" type="var">st'</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c1'</span> / <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">c1</span> ;; <span class="id" type="var">c2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">c1'</span> ;; <span class="id" type="var">c2</span>) / <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_SeqFinish</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">SKIP</span> ;; <span class="id" type="var">c2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c2</span> / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_IfTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">IFB</span> <span class="id" type="var">BTrue</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c1</span> / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_IfFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">IFB</span> <span class="id" type="var">BFalse</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c2</span> / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_IfStep</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">b</span> /<span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span><span class="id" type="var"><sub>b</sub></span> <span class="id" type="var">b'</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">IFB</span> <span class="id" type="var">b</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">IFB</span> <span class="id" type="var">b'</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_While</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">b</span> <span class="id" type="var">c1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">WHILE</span> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c1</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">IFB</span> <span class="id" type="var">b</span> <span class="id" type="var">THEN</span> (<span class="id" type="var">c1</span>;; (<span class="id" type="var">WHILE</span> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c1</span> <span class="id" type="var">END</span>)) <span class="id" type="var">ELSE</span> <span class="id" type="var">SKIP</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;New&nbsp;part:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_Par1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c1'</span> <span class="id" type="var">c2</span> <span class="id" type="var">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c1'</span> / <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">PAR</span> <span class="id" type="var">c1</span> <span class="id" type="var">WITH</span> <span class="id" type="var">c2</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">PAR</span> <span class="id" type="var">c1'</span> <span class="id" type="var">WITH</span> <span class="id" type="var">c2</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_Par2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span> <span class="id" type="var">c2'</span> <span class="id" type="var">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">c2'</span> / <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">PAR</span> <span class="id" type="var">c1</span> <span class="id" type="var">WITH</span> <span class="id" type="var">c2</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> (<span class="id" type="var">PAR</span> <span class="id" type="var">c1</span> <span class="id" type="var">WITH</span> <span class="id" type="var">c2'</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CS_ParDone</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">PAR</span> <span class="id" type="var">SKIP</span> <span class="id" type="var">WITH</span> <span class="id" type="var">SKIP</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;</span> <span class="id" type="var">SKIP</span> / <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> " t '/' st '<span style="font-family: arial;">&rArr;</span>' t' '/' st' " := (<span class="id" type="var">cstep</span> (<span class="id" type="var">t</span>,<span class="id" type="var">st</span>) (<span class="id" type="var">t'</span>,<span class="id" type="var">st'</span>)).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">cmultistep</span> := <span class="id" type="var">multi</span> <span class="id" type="var">cstep</span>.<br/>

<br/>
<span class="id" type="keyword">Notation</span> " t '/' st '<span style="font-family: arial;">&rArr;*</span>' t' '/' st' " := <br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">multi</span> <span class="id" type="var">cstep</span>  (<span class="id" type="var">t</span>,<span class="id" type="var">st</span>) (<span class="id" type="var">t'</span>,<span class="id" type="var">st'</span>)) <br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40, <span class="id" type="var">st</span> <span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 39, <span class="id" type="var">t'</span> <span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 39).<br/>

<br/>
</div>

<div class="doc">
Among the many interesting properties of this language is the fact
    that the following program can terminate with the variable <span class="inlinecode"><span class="id" type="var">X</span></span> set
    to any value... 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">par_loop</span> : <span class="id" type="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">PAR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Y</span> ::= <span class="id" type="var">ANum</span> 1<br/>
&nbsp;&nbsp;<span class="id" type="var">WITH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">WHILE</span> <span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">Y</span>) (<span class="id" type="var">ANum</span> 0) <span class="id" type="var">DO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">X</span> ::= <span class="id" type="var">APlus</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>) (<span class="id" type="var">ANum</span> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">END</span><br/>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br/>

<br/>
</div>

<div class="doc">
In particular, it can terminate with <span class="inlinecode"><span class="id" type="var">X</span></span> set to <span class="inlinecode">0</span>: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Example</span> <span class="id" type="var">par_loop_example_0</span>:<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">par_loop</span> / <span class="id" type="var">empty_state</span>  <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">SKIP</span> / <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">st'</span> <span class="id" type="var">X</span> = 0.<br/>
<div class="togglescript" id="proofcontrol21" onclick="toggleDisplay('proof21');toggleDisplay('proofcontrol21')"><span class="show"></span></div>
<div class="proofscript" id="proof21" onclick="toggleDisplay('proof21');toggleDisplay('proofcontrol21')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">ex_intro</span>. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">par_loop</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Ass</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_While</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq</span>. <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfFalse</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_ParDone</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
It can also terminate with <span class="inlinecode"><span class="id" type="var">X</span></span> set to <span class="inlinecode">2</span>: 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Example</span> <span class="id" type="var">par_loop_example_2</span>:<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">par_loop</span> / <span class="id" type="var">empty_state</span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">SKIP</span> / <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">st'</span> <span class="id" type="var">X</span> = 2.<br/>
<div class="togglescript" id="proofcontrol22" onclick="toggleDisplay('proof22');toggleDisplay('proofcontrol22')"><span class="show"></span></div>
<div class="proofscript" id="proof22" onclick="toggleDisplay('proof22');toggleDisplay('proofcontrol22')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">ex_intro</span>. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_While</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq</span>. <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfTrue</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">CS_AssStep</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Plus1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">CS_AssStep</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Plus</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Ass</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqFinish</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_While</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq</span>. <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfTrue</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">CS_AssStep</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Plus1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">CS_AssStep</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Plus</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Ass</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Ass</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_SeqFinish</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_While</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq</span>. <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfFalse</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_ParDone</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
</div>

<div class="doc">
More generally... 
<div class="paragraph"> </div>

<a name="lab621"></a><h4 class="section">Exercise: 3 stars, optional</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">par_body_n__Sn</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span> <span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">st</span> <span class="id" type="var">X</span> = <span class="id" type="var">n</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">st</span> <span class="id" type="var">Y</span> = 0 <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span class="id" type="var">par_loop</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;*</span> <span class="id" type="var">par_loop</span> / (<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">X</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab622"></a><h4 class="section">Exercise: 3 stars, optional</h4>

</div>
<div class="code code-space">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">par_body_n</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span> <span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">st</span> <span class="id" type="var">X</span> = 0 <span style="font-family: arial;">&and;</span> <span class="id" type="var">st</span> <span class="id" type="var">Y</span> = 0 <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">par_loop</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&rArr;*</span>  <span class="id" type="var">par_loop</span> / <span class="id" type="var">st'</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">st'</span> <span class="id" type="var">X</span> = <span class="id" type="var">n</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">st'</span> <span class="id" type="var">Y</span> = 0.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

 ... the above loop can exit with <span class="inlinecode"><span class="id" type="var">X</span></span> having any value
    whatsoever. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">par_loop_any_X</span>:<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span>, <span style="font-family: arial;">&exist;</span><span class="id" type="var">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">par_loop</span> / <span class="id" type="var">empty_state</span> <span style="font-family: arial;">&rArr;*</span>  <span class="id" type="var">SKIP</span> / <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">st'</span> <span class="id" type="var">X</span> = <span class="id" type="var">n</span>.<br/>
<div class="togglescript" id="proofcontrol23" onclick="toggleDisplay('proof23');toggleDisplay('proofcontrol23')"><span class="show"></span></div>
<div class="proofscript" id="proof23" onclick="toggleDisplay('proof23');toggleDisplay('proofcontrol23')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">par_body_n</span> <span class="id" type="var">n</span> <span class="id" type="var">empty_state</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">update</span>; <span class="id" type="tactic">reflexivity</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rename</span> <span class="id" type="var">x</span> <span class="id" type="var">into</span> <span class="id" type="var">st</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">HX</span> <span class="id" type="var">HY</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">Y</span> 1). <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">par_loop</span>,<span class="id" type="var">st</span>). <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Ass</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_While</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">AS_Id</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_eq</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfStep</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">BS_Eq</span>. <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_Par2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_IfFalse</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">multi_step</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">CS_ParDone</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">multi_refl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">CImp</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab623"></a><h1 class="section">A Small-Step Stack Machine</h1>

<div class="paragraph"> </div>

 Last example: a small-step semantics for the stack machine example
    from Imp.v. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">stack</span> := <span class="id" type="var">list</span> <span class="id" type="var">nat</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">prog</span>  := <span class="id" type="var">list</span> <span class="id" type="var">sinstr</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">stack_step</span> : <span class="id" type="var">state</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">prog</span> × <span class="id" type="var">stack</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">prog</span> × <span class="id" type="var">stack</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">SS_Push</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">stk</span> <span class="id" type="var">n</span> <span class="id" type="var">p'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">stack_step</span> <span class="id" type="var">st</span> (<span class="id" type="var">SPush</span> <span class="id" type="var">n</span> :: <span class="id" type="var">p'</span>, <span class="id" type="var">stk</span>)      (<span class="id" type="var">p'</span>, <span class="id" type="var">n</span> :: <span class="id" type="var">stk</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">SS_Load</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">stk</span> <span class="id" type="var">i</span> <span class="id" type="var">p'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">stack_step</span> <span class="id" type="var">st</span> (<span class="id" type="var">SLoad</span> <span class="id" type="var">i</span> :: <span class="id" type="var">p'</span>, <span class="id" type="var">stk</span>)      (<span class="id" type="var">p'</span>, <span class="id" type="var">st</span> <span class="id" type="var">i</span> :: <span class="id" type="var">stk</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">SS_Plus</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">stk</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">p'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">stack_step</span> <span class="id" type="var">st</span> (<span class="id" type="var">SPlus</span> :: <span class="id" type="var">p'</span>, <span class="id" type="var">n</span>::<span class="id" type="var">m</span>::<span class="id" type="var">stk</span>)  (<span class="id" type="var">p'</span>, (<span class="id" type="var">m</span>+<span class="id" type="var">n</span>)::<span class="id" type="var">stk</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">SS_Minus</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">stk</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">p'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">stack_step</span> <span class="id" type="var">st</span> (<span class="id" type="var">SMinus</span> :: <span class="id" type="var">p'</span>, <span class="id" type="var">n</span>::<span class="id" type="var">m</span>::<span class="id" type="var">stk</span>) (<span class="id" type="var">p'</span>, (<span class="id" type="var">m</span>-<span class="id" type="var">n</span>)::<span class="id" type="var">stk</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">SS_Mult</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">stk</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">p'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">stack_step</span> <span class="id" type="var">st</span> (<span class="id" type="var">SMult</span> :: <span class="id" type="var">p'</span>, <span class="id" type="var">n</span>::<span class="id" type="var">m</span>::<span class="id" type="var">stk</span>)  (<span class="id" type="var">p'</span>, (<span class="id" type="var">m</span>×<span class="id" type="var">n</span>)::<span class="id" type="var">stk</span>).<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">stack_step_deterministic</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">deterministic</span> (<span class="id" type="var">stack_step</span> <span class="id" type="var">st</span>).<br/>
<div class="togglescript" id="proofcontrol24" onclick="toggleDisplay('proof24');toggleDisplay('proofcontrol24')"><span class="show"></span></div>
<div class="proofscript" id="proof24" onclick="toggleDisplay('proof24');toggleDisplay('proofcontrol24')">
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">deterministic</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> <span class="id" type="var">x</span> <span class="id" type="var">y1</span> <span class="id" type="var">y2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">stack_multistep</span> <span class="id" type="var">st</span> := <span class="id" type="var">multi</span> (<span class="id" type="var">stack_step</span> <span class="id" type="var">st</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab624"></a><h4 class="section">Exercise: 3 stars, advanced (compiler_is_correct)</h4>
 Remember the definition of <span class="inlinecode"><span class="id" type="var">compile</span></span> for <span class="inlinecode"><span class="id" type="var">aexp</span></span> given in the 
    <span class="inlinecode"><span class="id" type="var">Imp</span></span> chapter. We want now to prove <span class="inlinecode"><span class="id" type="var">compile</span></span> correct with respect
    to the stack machine.

<div class="paragraph"> </div>

    State what it means for the compiler to be correct according to 
    the stack machine small step semantics and then prove it. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">compiler_is_correct_statement</span> : <span class="id" type="keyword">Prop</span> := <br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">admit</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">compiler_is_correct</span> : <span class="id" type="var">compiler_is_correct_statement</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" type="var">Admitted</span>.<br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

  
</div>
<div class="code code-tight">

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a></div>

</div>

</body>
</html>